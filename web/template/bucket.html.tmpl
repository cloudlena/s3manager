{{ define "content" }}
{{ $instancePath := "" }}
{{ if $.CurrentS3 }}{{ $instancePath = printf "/%s" $.CurrentS3.Name }}{{ end }}
<style>
.breadcrumb:before {
    content: '/';
}
#notifications {
    top: 20px;
    right: 30px;
    position: fixed;
    z-index: 2
}
.sortable-header {
    cursor: pointer;
    user-select: none;
}
.sortable-header:hover {
    background-color: rgba(0, 0, 0, 0.05);
}
.sort-icon {
    font-size: 16px;
    vertical-align: middle;
    margin-left: 4px;
}
</style>

<nav class="nav-extended">
    <div class="nav-wrapper container">
        <a href="{{$.RootURL}}{{$instancePath}}/buckets/{{$.BucketName}}" class="brand-logo center"><i class="material-icons">folder_open</i>{{ .BucketName }}</a>
        {{ if and (not .Objects) (not .HasError) }}
        <ul class="right">
            <li>
                <a class="waves-effect waves-light btn" href="#" onclick="deleteBucket({{ .BucketName }})">
                    Delete <i class="material-icons right">delete</i>
                </a>
            </li>
        </ul>
        {{ end }}
        <ul class="left">
            {{ if .CurrentS3 }}
            <li><span><i class="material-icons left">storage</i>{{ .CurrentS3.Name }}</span></li>
            {{ end }}
        </ul>
    </div>

    <div class="nav-wrapper container">
        <a href="{{$.RootURL}}{{$instancePath}}/buckets" class="breadcrumb"><i class="material-icons">arrow_back</i> buckets </a>
        {{ $url := printf "%s%s/buckets/%s/" $.RootURL $instancePath $.BucketName }}
        <a href="{{ $url }}" class="breadcrumb">{{ $.BucketName }}</a>

        {{ range $index, $path := .Paths }}
        {{ $url = printf "%s%s/" $url $path }}
        <a href="{{ $url }}" class="breadcrumb">{{ $path }}</a>
        {{ end -}}
    </div>
  </div>
</nav>

<div class="section" style="margin: 10px; position: relative; padding-bottom: 3rem;">
    {{ if .HasError }}
    <div class="row">
        <div class="col s12">
            <div class="card red lighten-4">
                <div class="card-content">
                    <div class="row">
                        <div class="col s1">
                            <i class="material-icons large red-text">error</i>
                        </div>
                        <div class="col s11">
                            <span class="card-title red-text text-darken-2">Connection Error</span>
                            <p>{{ .ErrorMessage }}</p>
                            {{ if gt (len .S3Instances) 1 }}
                            <p><strong>Tip:</strong> Try switching to another S3 instance from the list below.</p>
                            {{ end }}
                            <div style="margin-top: 20px;">
                                <a href="{{$.RootURL}}{{$instancePath}}/buckets" class="waves-effect waves-green btn">
                                    <i class="material-icons left">arrow_back</i>Go back to buckets
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {{ else }}
    
    <!-- Search Bar -->
    <div class="row" style="margin-bottom: 10px;">
        <div class="col s12 m8 l6">
            <form id="search-form" onsubmit="return performSearch(event);">
                <div class="input-field">
                    <i class="material-icons prefix">search</i>
                    <input type="text" id="search-input" name="search" value="{{ .Search }}" placeholder="Search objects...">
                    {{ if .Search }}
                    <i class="material-icons suffix" onclick="clearSearch()" style="cursor: pointer; position: absolute; right: 0; top: 50%; transform: translateY(-50%);">close</i>
                    {{ end }}
                </div>
            </form>
        </div>
        {{ if .Search }}
        <div class="col s12">
            <p style="color: #666; margin-top: -10px;">
                <i class="material-icons tiny" style="vertical-align: middle;">info_outline</i>
                Showing results for "<strong>{{ .Search }}</strong>"
                {{ if eq .TotalItems 0 }}
                - No matches found
                {{ end }}
            </p>
        </div>
        {{ end }}
    </div>

    {{ if .Objects }}
    <!-- Bulk Actions Bar -->
    <div id="bulk-actions-bar" style="margin-bottom: 15px; display: none;">
        <button class="waves-effect waves-light btn teal" onclick="bulkDownload()" style="margin-right: 10px;">
            Download Selected
        </button>
        {{- if $.AllowDelete }}
        <button class="waves-effect waves-light btn red" onclick="bulkDelete()">
            Delete Selected
        </button>
        {{- end }}
        <span id="selected-count" style="margin-left: 15px; font-weight: bold;"></span>
    </div>

    <table class="striped">
        <thead>
            <tr>
                <th style="width: 40px;">
                    <label>
                        <input type="checkbox" id="select-all" onchange="toggleSelectAll()" />
                        <span></span>
                    </label>
                </th>
                <th class="sortable-header" onclick="sortBy('key')">
                    Key
                    {{ if eq .SortBy "key" }}
                        {{ if eq .SortOrder "asc" }}
                            <i class="material-icons sort-icon">arrow_upward</i>
                        {{ else }}
                            <i class="material-icons sort-icon">arrow_downward</i>
                        {{ end }}
                    {{ end }}
                </th>
                <th class="sortable-header" onclick="sortBy('size')">
                    Size
                    {{ if eq .SortBy "size" }}
                        {{ if eq .SortOrder "asc" }}
                            <i class="material-icons sort-icon">arrow_upward</i>
                        {{ else }}
                            <i class="material-icons sort-icon">arrow_downward</i>
                        {{ end }}
                    {{ end }}
                </th>
                <th class="sortable-header" onclick="sortBy('owner')">
                    Owner
                    {{ if eq .SortBy "owner" }}
                        {{ if eq .SortOrder "asc" }}
                            <i class="material-icons sort-icon">arrow_upward</i>
                        {{ else }}
                            <i class="material-icons sort-icon">arrow_downward</i>
                        {{ end }}
                    {{ end }}
                </th>
                <th class="sortable-header" onclick="sortBy('lastModified')">
                    Last Modified
                    {{ if eq .SortBy "lastModified" }}
                        {{ if eq .SortOrder "asc" }}
                            <i class="material-icons sort-icon">arrow_upward</i>
                        {{ else }}
                            <i class="material-icons sort-icon">arrow_downward</i>
                        {{ end }}
                    {{ end }}
                </th>
                <th style="min-width:165px;"></th>
            </tr>
        </thead>

        <tbody>
            {{ range $index, $object := .Objects }}
            <tr>
                <td>
                    {{ if not $object.IsFolder }}
                    <label>
                        <input type="checkbox" class="object-checkbox" data-key="{{ $object.Key }}" onchange="updateBulkActions()" />
                        <span></span>
                    </label>
                    {{ end }}
                </td>
                <td
                    {{ if $object.IsFolder }}
                    onclick="location.href='{{$.RootURL}}{{$instancePath}}/buckets/{{ $.BucketName }}/{{ $object.Key }}'"
                    style="cursor:pointer;"
                    {{ end }}>
                    <i class="material-icons">{{ $object.Icon }}</i> {{ $object.DisplayName }}
                </td>
                <td>{{ $object.SizeDisplay }}</td>
                <td>{{ $object.Owner }}</td>
                <td>{{ $object.LastModified }}</td>
                <td>
                    {{ if not $object.IsFolder }}
                        <button class="dropdown-trigger waves-effect waves-teal btn" data-target="actions-dropdown-{{ $index }}">
                            Actions <i class="material-icons right">arrow_drop_down</i>
                        </button>
                        <!-- Dropdown Structure -->
                        <ul id="actions-dropdown-{{ $index }}" class="dropdown-content">
                            <li><a target="_blank" href="{{$.RootURL}}{{$instancePath}}/api/buckets/{{ $.BucketName }}/objects/{{ $object.Key }}">Download</a></li>
                            <li><a onclick="handleOpenDownloadLinkModal({{ $object.Key }})">Download link</a></li>
                            {{- if $.AllowDelete }}
                            <li><a href="#" onclick="deleteObject({{ $.BucketName }}, {{ $object.Key }})">Delete</a></li>
                            {{- end }}
                        </ul>
                    {{ end }}
                </td>
            </tr>
            {{ end }}
        </tbody>
    </table>

    <!-- Pagination Controls -->
    <div class="row" style="margin-top: 20px;">
        <div class="col s12 m6">
            <div class="input-field" style="margin-top: 0;">
                <select id="perPageSelect" onchange="changePerPage()">
                    <option value="25" {{ if eq .PerPage 25 }}selected{{ end }}>25 per page</option>
                    <option value="50" {{ if eq .PerPage 50 }}selected{{ end }}>50 per page</option>
                    <option value="100" {{ if eq .PerPage 100 }}selected{{ end }}>100 per page</option>
                    <option value="200" {{ if eq .PerPage 200 }}selected{{ end }}>200 per page</option>
                    <option value="500" {{ if eq .PerPage 500 }}selected{{ end }}>500 per page</option>
                    <option value="0" {{ if eq .TotalItems .PerPage }}selected{{ end }}>All</option>
                </select>
                <label>Items per page</label>
            </div>
            <p style="margin-top: -10px; color: #666;">Showing {{ if gt .TotalItems 0 }}{{ add (mul (sub .Page 1) .PerPage) 1 }} - {{ min (mul .Page .PerPage) .TotalItems }}{{ else }}0{{ end }} of {{ .TotalItems }} items</p>
        </div>
        <div class="col s12 m6">
            <ul class="pagination right">
                {{ if .HasPrevPage }}
                <li class="waves-effect"><a href="#" onclick="changePage(1)"><i class="material-icons">first_page</i></a></li>
                <li class="waves-effect"><a href="#" onclick="changePage({{ sub .Page 1 }})"><i class="material-icons">chevron_left</i></a></li>
                {{ else }}
                <li class="disabled"><a href="#!"><i class="material-icons">first_page</i></a></li>
                <li class="disabled"><a href="#!"><i class="material-icons">chevron_left</i></a></li>
                {{ end }}
                
                {{ $currentPage := .Page }}
                {{ $totalPages := .TotalPages }}
                {{ $startPage := sub $currentPage 2 }}
                {{ if lt $startPage 1 }}{{ $startPage = 1 }}{{ end }}
                {{ $endPage := add $currentPage 2 }}
                {{ if gt $endPage $totalPages }}{{ $endPage = $totalPages }}{{ end }}
                
                {{ if gt $startPage 1 }}
                <li class="waves-effect"><a href="#" onclick="changePage(1)">1</a></li>
                {{ if gt $startPage 2 }}
                <li class="disabled"><a href="#!">...</a></li>
                {{ end }}
                {{ end }}
                
                {{ range $i := iterate $startPage (add $endPage 1) }}
                {{ if eq $i $currentPage }}
                <li class="active"><a href="#!">{{ $i }}</a></li>
                {{ else }}
                <li class="waves-effect"><a href="#" onclick="changePage({{ $i }})">{{ $i }}</a></li>
                {{ end }}
                {{ end }}
                
                {{ if lt $endPage $totalPages }}
                {{ if lt $endPage (sub $totalPages 1) }}
                <li class="disabled"><a href="#!">...</a></li>
                {{ end }}
                <li class="waves-effect"><a href="#" onclick="changePage({{ $totalPages }})">{{ $totalPages }}</a></li>
                {{ end }}
                
                {{ if .HasNextPage }}
                <li class="waves-effect"><a href="#" onclick="changePage({{ add .Page 1 }})"><i class="material-icons">chevron_right</i></a></li>
                <li class="waves-effect"><a href="#" onclick="changePage({{ .TotalPages }})"><i class="material-icons">last_page</i></a></li>
                {{ else }}
                <li class="disabled"><a href="#!"><i class="material-icons">chevron_right</i></a></li>
                <li class="disabled"><a href="#!"><i class="material-icons">last_page</i></a></li>
                {{ end }}
            </ul>
        </div>
    </div>

    {{ else }}
    <p style="text-align:center;margin-top:2em;color:gray;">
        {{ if .Search }}
        No objects matching "<strong>{{ .Search }}</strong>" found in <strong>{{ .BucketName }}/{{ .CurrentPath }}</strong>
        {{ else }}
        No objects in <strong>{{ .BucketName }}/{{ .CurrentPath }}</strong> yet
        {{ end }}
    </p>
    {{ end }}
    {{ end }}

    <div id="notifications">
        <div id="notification-template" class="card" style="display: none;">
            <div class="card-content" style="padding: 12px">
                <span class="card-title">Uploading</span>
                <p> I am a very simple card </p>
                <div class="progress">
                    <div class="indeterminate"></div>
                </div>
            </div>
        </div>
    </div>
</div>

{{ if not .HasError }}
<div class="fixed-action-btn">
    <button type="button" class="btn-floating btn-large red tooltipped" id="upload-file-btn" data-position="top" data-tooltip="Upload files">
        <i class="large material-icons">add</i>
    </button>

    <button type="button" class="btn-floating btn-large red tooltipped" id="upload-folder-btn" data-position="top" data-tooltip="Upload folder">
        <i class="large material-icons">create_new_folder</i>
    </button>

     <button type="button" class="btn-floating btn-large red modal-trigger tooltipped" data-target="modal-change-path" data-position="top" data-tooltip="Change path">
        <i class="large material-icons">create</i>
    </button>
</div>
{{ end }}

<input type="file" id="upload-folder-input" webkitdirectory multiple style="display: none;">
<input type="file" id="upload-file-input" name="file" multiple style="display: none;">

<div id="modal-change-path" class="modal">
    <form id="change-path-form" enctype="multipart/form-data">
        <div class="modal-content">
            <h4>Change directory path</h4>
            <br>
            <div class="row">
                <div class="col s6">
                    <div class="input-field">
                        <input name="new-path" id="new-path" type="text">
                        <label for="new-path">Path</label>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="modal-close waves-effect waves-green btn-flat">Cancel</button>
            <button type="submit" class="modal-close waves-effect waves-green btn">Change path</button>
        </div>
    </form>
</div>

<div id="modal-create-download-link" class="modal">
    <form id="download-link-form">
        <div class="modal-content">
            <div class="row">
                <h4>Create download link for </h4>
                <input name="objectName" id="objectName" type="text" readonly>
            </div>
            <div class="row">
                <div class="col s4">
                    <div class="input-field">
                        <input name="day" id="gen-link-day" value="0" type="text" pattern="^[\d]+$" class="validate">
                        <label for="gen-link-day">Day</label>
                        <span class="helper-text" data-error="Invalid day format"></span>
                    </div>
                </div>
                <div class="col s4">
                    <div class="input-field">
                        <input name="hour" id="gen-link-hour" value="1" type="text" pattern="^([0-9]|1\d|2[0-3])$" class="validate">
                        <label for="gen-link-hour">Hour</label>
                        <span class="helper-text" data-error="Invalid hour format"></span>
                    </div>
                </div>
                <div class="col s4">
                    <div class="input-field">
                        <input name="minute" id="gen-link-minute" value="0" type="text" pattern="^([0-9]|[1-5]\d)$" class="validate">
                        <label for="gen-link-minute">Minute</label>
                        <span class="helper-text" data-error="Invalid minute format"></span>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col s3">
                    <button id="create-link-btn" class="waves-effect waves-green btn">Create link</button>
                </div>
                <div class="col s9 red-text text-darken-2" id="gen-url-error"></div>
            </div>
            <div class="row">
                <div class="col s11">
                    <div class="input-field">
                        <i class="material-icons prefix" onclick="handleCopyLink()" style="cursor:pointer;">content_copy</i>
                        <input name="generated-link" id="generated-link" type="text" readonly>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

<script>
function performSearch(event) {
    event.preventDefault();
    const searchValue = document.getElementById('search-input').value.trim();
    const url = new URL(window.location.href);
    
    if (searchValue) {
        url.searchParams.set('search', searchValue);
    } else {
        url.searchParams.delete('search');
    }
    url.searchParams.set('page', '1'); // Reset to first page when searching
    
    window.location.href = url.toString();
    return false;
}

function clearSearch() {
    const url = new URL(window.location.href);
    url.searchParams.delete('search');
    url.searchParams.set('page', '1');
    window.location.href = url.toString();
}

function changePage(page) {
    const url = new URL(window.location.href);
    url.searchParams.set('page', page);
    window.location.href = url.toString();
}

function changePerPage() {
    const perPage = document.getElementById('perPageSelect').value;
    const url = new URL(window.location.href);
    url.searchParams.set('perPage', perPage);
    url.searchParams.set('page', '1'); // Reset to first page when changing items per page
    window.location.href = url.toString();
}

function sortBy(field) {
    const urlParams = new URLSearchParams(window.location.search);
    const currentSortBy = urlParams.get('sortBy') || 'key';
    const currentSortOrder = urlParams.get('sortOrder') || 'asc';
    
    let newSortOrder = 'asc';
    if (field === currentSortBy) {
        // Toggle sort order if clicking the same field
        newSortOrder = currentSortOrder === 'asc' ? 'desc' : 'asc';
    }
    
    // Build new URL with sort parameters, preserve search and pagination
    const url = new URL(window.location.href);
    url.searchParams.set('sortBy', field);
    url.searchParams.set('sortOrder', newSortOrder);
    url.searchParams.set('page', '1'); // Reset to first page when sorting
    
    window.location.href = url.toString();
}

function deleteObject(bucketName, objectName) {
    $.ajax({
        type: 'DELETE',
        url: '{{$.RootURL}}{{$instancePath}}/api/buckets/' + bucketName + '/objects/' + objectName,
        success: function () { location.reload(); }
    })
}

function deleteBucket(bucketName) {
    $.ajax({
        type: 'DELETE',
        url: '{{$.RootURL}}{{$instancePath}}/api/buckets/' + bucketName,
        success: function () { window.location.replace('{{$.RootURL}}{{$instancePath}}/buckets'); }
    })
}

function handleUploadFiles(event) {
    files = event.target.files
    url = "{{$.RootURL}}{{$instancePath}}/api/buckets/{{ .BucketName }}/objects"
    uploadFiles(files, url);
}

function handleChangePath(event) {
    event.preventDefault();

    const form = event.target;
    const formData = new FormData(form);

    let appendPath = formData.get("new-path")
    if(!appendPath.endsWith("/")) {
        appendPath = appendPath + "/";
    }

    let currentPath = window.location.href
    if(!currentPath.endsWith("/")) {
        currentPath = currentPath + "/";
    }

    form.reset();
    window.location.href = currentPath + appendPath;
}

function uploadFiles(files, url) {
    uploadPromises = [];
    for(file of files) {
        uploadPromises.push(uploadFile(file, url));
    }
    Promise.all(uploadPromises).then(values => {
        window.location.reload();
    });
}

function uploadFile(file, url) {
    const formData = new FormData();
    formData.append('file', file);
    if( !!file.webkitRelativePath ) {
        formData.append('path', "{{ .CurrentPath }}" + file.webkitRelativePath );
    } else {
        formData.append('path', "{{ .CurrentPath }}" + file.name );
    }

    const notification = createNotification(file.name);
    notifications = document.getElementById('notifications');
    notifications.appendChild(notification);

    return fetch(url, {
        method: "POST",
        body: formData
    }).then(response => {
        notifications.removeChild(notification);
    })
}

function createNotification(fileName) {
    notificationTemplate = document.getElementById('notification-template');
    notification = notificationTemplate.cloneNode(true);
    notification.getElementsByTagName('p')[0].innerHTML = fileName;
    notification.removeAttribute("id");
    notification.removeAttribute("style");
    return notification;
}

function handleOpenDownloadLinkModal(objectName) {
    const downloadLinkForm = document.forms['download-link-form']
    downloadLinkForm.elements['objectName'].value = objectName;

    const createLinkModalElement = document.getElementById('modal-create-download-link')
    document.getElementById('generated-link').setAttribute('value', "");
    document.getElementById('gen-url-error').innerHTML = "";
    const modalInstance = M.Modal.init(createLinkModalElement);
    modalInstance.open()
}

function handleGenerateDownloadLink(event) {
    event.preventDefault();

    const form = event.target;
    const formData = new FormData(form);
    const objectName = formData.get('objectName');
    const genUrlMessage = document.getElementById('gen-url-error');

    const expiryTime = formData.get('day') * 24 * 60 * 60 + formData.get('hour') * 60 * 60 + formData.get('minute') * 60;

    if(expiryTime > 7 * 24 * 60 * 60) {
        genUrlMessage.innerHTML = "Expiry time must be less than 7 days";
        return;
    }

    $.ajax({
        type: 'GET',
        url: '{{$.RootURL}}{{$instancePath}}/api/buckets/' + {{ $.BucketName }}+ "/objects/" + objectName + "/url?expiry=" + expiryTime,
        success: function (result) {
            genUrlMessage.innerHTML = "";
            document.getElementById("generated-link").setAttribute('value', JSON.parse(result).url);
        },
        error: function(request, status, error) {
            genUrlMessage.innerHTML = "Error when generating url";
        }
    });
}

function handleCopyLink() {
    const url = document.getElementById("generated-link").value;

    if(!!url) {
        navigator.clipboard.writeText(url).then(function() {
            M.toast({html: 'Copied to clipboard!'});
        }, function(err) {
            console.error('Could not copy:', err);
        });
    }
}

function toggleSelectAll() {
    const selectAllCheckbox = document.getElementById('select-all');
    const checkboxes = document.querySelectorAll('.object-checkbox');
    checkboxes.forEach(cb => {
        cb.checked = selectAllCheckbox.checked;
    });
    updateBulkActions();
}

function updateBulkActions() {
    const checkboxes = document.querySelectorAll('.object-checkbox');
    const checkedBoxes = Array.from(checkboxes).filter(cb => cb.checked);
    const count = checkedBoxes.length;
    
    const bulkActionsBar = document.getElementById('bulk-actions-bar');
    const selectedCount = document.getElementById('selected-count');
    const selectAllCheckbox = document.getElementById('select-all');
    
    if (count > 0) {
        bulkActionsBar.style.display = 'block';
        selectedCount.textContent = count + ' item' + (count > 1 ? 's' : '') + ' selected';
    } else {
        bulkActionsBar.style.display = 'none';
    }
    
    // Update select-all checkbox state
    selectAllCheckbox.checked = count === checkboxes.length && count > 0;
    selectAllCheckbox.indeterminate = count > 0 && count < checkboxes.length;
}

function getSelectedKeys() {
    const checkboxes = document.querySelectorAll('.object-checkbox:checked');
    return Array.from(checkboxes).map(cb => cb.getAttribute('data-key'));
}

function bulkDelete() {
    const selectedKeys = getSelectedKeys();
    if (selectedKeys.length === 0) return;
    
    const confirmMsg = 'Are you sure you want to delete ' + selectedKeys.length + ' item' + (selectedKeys.length > 1 ? 's' : '') + '?';
    if (!confirm(confirmMsg)) return;
    
    $.ajax({
        type: 'POST',
        url: '{{$.RootURL}}{{$instancePath}}/api/buckets/{{ .BucketName }}/objects/bulk-delete',
        contentType: 'application/json',
        data: JSON.stringify({ keys: selectedKeys }),
        success: function () {
            // Clear all checkboxes before reload
            document.querySelectorAll('.object-checkbox').forEach(cb => cb.checked = false);
            document.getElementById('select-all').checked = false;
            updateBulkActions();
            // Reload the page
            location.reload();
        },
        error: function(xhr, status, error) {
            alert('Error deleting objects: ' + error);
        }
    });
}

function bulkDownload() {
    const selectedKeys = getSelectedKeys();
    if (selectedKeys.length === 0) return;
    
    // Create a form and submit it to trigger download
    const form = document.createElement('form');
    form.method = 'POST';
    form.action = '{{$.RootURL}}{{$instancePath}}/api/buckets/{{ .BucketName }}/objects/bulk-download';
    
    const input = document.createElement('input');
    input.type = 'hidden';
    input.name = 'keys';
    input.value = JSON.stringify(selectedKeys);
    
    form.appendChild(input);
    document.body.appendChild(form);
    form.submit();
    document.body.removeChild(form);
}

window.onload = (event) => {
    $('#change-path-form').submit(handleChangePath)
    $('#download-link-form').submit(handleGenerateDownloadLink)

    uploadFolderInput = $('#upload-folder-input');
    $('#upload-folder-btn').click(event => uploadFolderInput.click());
    uploadFolderInput.change(handleUploadFiles);

    uploadFileInput = $('#upload-file-input');
    $('#upload-file-btn').click(event => uploadFileInput.click());
    uploadFileInput.change(handleUploadFiles);

    $(document).ready(function(){
        $('.tooltipped').tooltip();
        $('select').formSelect(); // Initialize select dropdowns
    });
};
</script>
{{ end }}
